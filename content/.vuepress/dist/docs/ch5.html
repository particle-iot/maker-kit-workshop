<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 5: Controlling your devices from the cloud | Particle Maker Kit Workshop</title>
    <meta name="description" content="Workshops designed to teach the basics of IoT development with the Particle ecosystem &amp; the Particle Photon">
    
    
    <link rel="preload" href="/assets/css/7.styles.78510396.css" as="style"><link rel="preload" href="/assets/js/app.f96e0021.js" as="script"><link rel="preload" href="/assets/js/0.a98946f6.js" as="script"><link rel="prefetch" href="/assets/js/1.ed1cf747.js"><link rel="prefetch" href="/assets/js/2.ee22b393.js"><link rel="prefetch" href="/assets/js/3.43b75f49.js"><link rel="prefetch" href="/assets/js/4.7d8ce466.js"><link rel="prefetch" href="/assets/js/5.d42eafc0.js"><link rel="prefetch" href="/assets/js/6.aeee8a8b.js">
    <link rel="stylesheet" href="/assets/css/7.styles.78510396.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Particle Maker Kit Workshop
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://particle.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Team
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><a href="https://github.com/particle-iot/maker-kit-workshop" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://particle.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Team
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><a href="https://github.com/particle-iot/maker-kit-workshop" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><a href="/docs/" class="sidebar-link">About Particle Workshops</a></li><li><a href="/docs/ch1.html" class="sidebar-link">Chapter 1: Claiming your device</a></li><li><a href="/docs/ch2.html" class="sidebar-link">Chapter 2: Reading from sensors and posting data to the cloud</a></li><li><a href="/docs/ch3.html" class="sidebar-link">Chapter 3: Connecting the Particle Device Cloud to Azure</a></li><li><a href="/docs/ch4.html" class="sidebar-link">Chapter 4: Visualizing sensor data in the cloud</a></li><li><a href="/docs/ch5.html" class="active sidebar-link">Chapter 5: Controlling your devices from the cloud</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/ch5.html#wire-up-the-status-rgb-led-to-your-photon" class="sidebar-link">Wire up the status RGB LED to your Photon</a></li><li class="sidebar-sub-header"><a href="/docs/ch5.html#add-an-event-subscription-to-capture-events-from-azure" class="sidebar-link">Add an event subscription to capture events from Azure</a></li><li class="sidebar-sub-header"><a href="/docs/ch5.html#processing-sensor-data-in-azure-and-publishing-events" class="sidebar-link">Processing sensor data in Azure and publishing events</a></li></ul></li></ul></div><div class="page"><div class="content"><h1 id="chapter-5-controlling-your-devices-from-the-cloud"><a href="#chapter-5-controlling-your-devices-from-the-cloud" aria-hidden="true" class="header-anchor">#</a> Chapter 5: Controlling your devices from the cloud</h1><table><thead><tr><th><strong>Project Goal</strong></th><th>Process sensor data in the cloud, and publish events to control an RGB LED on your Photon.</th></tr></thead><tbody><tr><td><strong>What you’ll learn</strong></td><td>How to control an RGB LED from a Photon; Subscribing to Device Cloud events; Publishing events from Azure.</td></tr><tr><td><strong>Tools you’ll need</strong></td><td>build.particle.io, A Particle Photon and Maker Kit; Microsoft Azure Account</td></tr><tr><td><strong>Time needed to complete</strong></td><td>30 minutes</td></tr></tbody></table><p>In this session, we're going to tie everything together by adding an RGB LED to our project that can be controlled from the cloud. Our Azure instance will monitor the incoming temperature readings, and with the help of an Azure Function, we can fire events that will tell our RGB LED which colors to use based on the temp we pass along.</p><p>If you get stuck at any point, <a href="https://go.particle.io/shared_apps/5b85708299b6c19f4f00008e" target="_blank" rel="noopener noreferrer">click here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for the completed source.</p><h2 id="wire-up-the-status-rgb-led-to-your-photon"><a href="#wire-up-the-status-rgb-led-to-your-photon" aria-hidden="true" class="header-anchor">#</a> Wire up the status RGB LED to your Photon</h2><p><img src="/assets/img/rgb-circuit.a32acbd7.jpg" alt></p><p>To build this circuit, you'll need the following items:</p><ul><li>Photon in breadboard (this is how it comes in the Maker Kit)</li><li>1x Clear cap RGB LED. The RGB LED has four leads: the left lead is for the blue light, second for green and the right lead for the red light. The longest lead is the common anode, which we'll connect to our power source.</li></ul><p><img src="/assets/img/rgbled.4b854679.jpg" alt></p><ul><li>2x red, green, and blue jumper wires.</li><li>3x 330 Ohm Resistors. The maker kit includes four different types of resistors (220, 1k, 4.7k and 10k ohm). The one you need is blue, with red, red, black, black and brown bands, as depicted below.</li></ul><p><img src="/assets/img/resistors.1be75f7b.jpg" alt></p><ol><li>The RGB LED has four leads. One common anode lead, and one each for the red, green and blue diodes inside the LED. Start by plugging the four legs into the first four rows of column J on your breadboard. Make sure the LED is oriented where the longest leg, the common anode, is the second from the right before you plug it in.</li></ol><p><img src="/assets/img/ledpluggedin.e7ad1d88.jpg" alt></p><ol start="2"><li>For each LED led, we'll need to wire a resistor in series to keep the LED safe. Grab the first resistor and plug one leg into the first row of column G, then plug the other led into the first row of column D.</li></ol><p><img src="/assets/img/redresistor.333c2dce.jpg" alt></p><ol start="3"><li>The lead at A1 is the red LED, so take a red jumper wire and place one end into the first row of column A. Place the other end into the <code>D2</code> pin on the Photon.</li></ol><p><img src="/assets/img/redwire.da2e39ce.jpg" alt></p><ol start="4"><li>The second lead is the common anode lead, which we'll plug into our power source. Take the red jumper wire and plug it into row two of column H. Plug the other end into the <code>3V3</code> pin of the Photon.</li></ol><p><img src="/assets/img/blackwire.86bbfe3d.jpg" alt></p><ol start="5"><li>Take the second resistor and plug one leg into the third row of column G, then plug the other led into the third row of column D.</li></ol><p><img src="/assets/img/greenresistor.ea711f7f.jpg" alt></p><ol start="6"><li>The third lead is the green LED, so take a green jumper wire and place one end into the third row of column A. Plug the other end into the <code>D1</code> pin on the Photon.</li></ol><p><img src="/assets/img/greenwire.31f956bd.jpg" alt></p><ol start="7"><li>Take the third resistor and plug one leg into the fourth row of column G, then plug the other led into the fourth row of column D.</li></ol><p><img src="/assets/img/blueresistor.357d9a2e.jpg" alt></p><ol start="8"><li>Finally, The fourth lead is the blue LED, so take a blue jumper wire and place one end into the fourth row of column A. Plug the other end into the <code>D1</code> pin on the Photon.</li></ol><p><img src="/assets/img/bluewire.1ce9d384.jpg" alt></p><p>With our RGB LED circuit all wired up, let's write the firmware code for lighting it up when we receive an event from the cloud.</p><h2 id="add-an-event-subscription-to-capture-events-from-azure"><a href="#add-an-event-subscription-to-capture-events-from-azure" aria-hidden="true" class="header-anchor">#</a> Add an event subscription to capture events from Azure</h2><ol><li>First, let's create some <code>#define</code> statements to manage the pins of our RGB LED. Add these three lines after the <code>#define</code> we created in part two of this workshop.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">define</span> RED_PIN D2</span>
<span class="token macro property">#<span class="token directive keyword">define</span> GREEN_PIN D1</span>
<span class="token macro property">#<span class="token directive keyword">define</span> BLUE_PIN D0</span>
</code></pre></div><ol start="2"><li>Now let's set the <code>pinMode</code> of each pin on the RGB LED to be an output by adding the following lies to the beginning of our <code>setup</code> function.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">pinMode</span><span class="token punctuation">(</span>RED_PIN<span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">pinMode</span><span class="token punctuation">(</span>GREEN_PIN<span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">pinMode</span><span class="token punctuation">(</span>BLUE_PIN<span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>Next, let's add the <code>subscribe</code> primitive. <code>subscribe</code> tells the device cloud to watch for events that match a name and, like a <code>Particle.function</code> defines a handler to call when that event is received. Add the following line to <code>setup</code>.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code>Particle<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;setLED&quot;</span><span class="token punctuation">,</span> setLEDColor<span class="token punctuation">,</span> MY_DEVICES<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>At the end of <code>setup</code> we'll also initialize the RGB LED to be totally off. Since the RGB LED in the maker kit is a common anode LED, all three leads receive power by default. To turn them off, we pass in the max analog value or 255. Add the following to the end of the <code>setup</code> function.</li></ol><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">analogWrite</span><span class="token punctuation">(</span>RED_PIN<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">analogWrite</span><span class="token punctuation">(</span>BLUE_PIN<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">analogWrite</span><span class="token punctuation">(</span>GREEN_PIN<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>analogWrite</code> is a standard Arduino-style function for setting analog values on a GPIO pin. Unlike <code>digitalWrite</code>, which sets a pin either <code>HIGH</code> (digital 0 or 0 volts) or <code>LOW</code> (digital 1 or 3.3 volts on the Photon), <code>analogWrite</code> takes an integer value between 0 and 255 and converts that to a voltage in the operating range of the device (0 to 3.3 volts in the case of the Photon). This allows us to do some pretty cool stuff like turning a servo or motor, or controlling the brightness of an LED!</p></div><ol start="5"><li>Finally, let's add the <code>setLEDColor</code> function for our <code>subscribe</code> handler. Like <code>Particle.function</code> a subscribe handler needs to have a precise signature. It returns void and takes two char arrays for the event name and any data provided by the event. Copy the following into your program.</li></ol><div class="language-cpp extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">setLEDColor</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>event<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> red<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue<span class="token punctuation">;</span>
  <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">sscanf</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">&quot;%02x%02x%02x&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>red<span class="token punctuation">,</span> <span class="token operator">&amp;</span>green<span class="token punctuation">,</span> <span class="token operator">&amp;</span>blue<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">analogWrite</span><span class="token punctuation">(</span>RED_PIN<span class="token punctuation">,</span> <span class="token number">255</span> <span class="token operator">-</span> red<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">analogWrite</span><span class="token punctuation">(</span>BLUE_PIN<span class="token punctuation">,</span> <span class="token number">255</span> <span class="token operator">-</span> blue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">analogWrite</span><span class="token punctuation">(</span>GREEN_PIN<span class="token punctuation">,</span> <span class="token number">255</span> <span class="token operator">-</span> green<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The key piece here is the <code>sscanf</code> function in the third line. In short, <a href="http://www.cplusplus.com/reference/cstdio/sscanf/" target="_blank" rel="noopener noreferrer">this function<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> allows us to provide a C-style string (a char array) and a format string to use to extract multiple values from the input string into the variables provided by the remaining parameters (red, green, and blue, in this case). The format string (<code>%02x%02x%02x</code>) tells the function to read each pair of input values (<code>%02</code>) as a hexadecimal value (<code>x</code>) and place the result in the red, green, and blue variables, respectively.</p><p>Once we have those values extracted, we'll perform an <code>analogWrite</code> on each pin to set each color. Again, because this is a common anode RGB LED, we subtract the hex value from 255 in order to get the correct value for the LED.</p><ol start="6"><li><p>Flash the firmware to your device.</p></li><li><p>Navigate to your device page in the Particle Console. Under Event Logs, there's a <code>Publish Event</code> button. Click on it to open the event publishing UI.</p></li></ol><p><img src="/assets/img/publishUI.b0ad5cb9.png" alt></p><ol start="8"><li>In the event name textbox, enter &quot;setLED&quot; and a six character hex string for a color, like <code>FF0000</code>, in the Event data textbox.</li></ol><p><img src="data:image/png;base64,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" alt></p><ol start="9"><li>Click the &quot;Publish&quot; button. Your RGB LED should light up with the color you provided.</li></ol><p><img src="/assets/img/redLED.9dc11bb6.gif" alt></p><ol start="10"><li>Try changing the color string to other hex values like <code>00FF00</code>, <code>0000FF</code>, <code>808080</code></li></ol><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>To turn the light back off, you can publish an event with <code>000000</code> in the Event data field.</p></div><p>Now that we have everything wired up on our device, lets publish events from the cloud!</p><h2 id="processing-sensor-data-in-azure-and-publishing-events"><a href="#processing-sensor-data-in-azure-and-publishing-events" aria-hidden="true" class="header-anchor">#</a> Processing sensor data in Azure and publishing events</h2><p>We can use Azure to process sensor events as they come in to IoT Hub. We can really do anything we want with the data once it's in Azure. That's the magic of the cloud. Let's setup an Azure Function which fires each time the temperature changes and then calls back to the Particle Cloud with the color to change the RBG bulb to.</p><h3 id="add-new-consumer-group"><a href="#add-new-consumer-group" aria-hidden="true" class="header-anchor">#</a> Add new Consumer Group</h3><p>Each time you add a new endpoint or service which will interact with IoT Hub, it's a best practice to give that it's own Consumer Group. We're going to wire up an Azure Function, so let's create a new Consumer Group in IoT Hub for this Serverless Function.</p><ol><li>In your IoT Hub, select the &quot;Events&quot;</li></ol><p><img src="/assets/img/event-hub-endpoints-events.7b98f4ac.png" alt></p><ol start="2"><li>Create a new Consumer Group called &quot;function&quot;. Don't forget to click &quot;save&quot;.</li></ol><p><img src="/assets/img/new-consumer-group.a103272f.png" alt></p><h3 id="create-a-new-azure-function"><a href="#create-a-new-azure-function" aria-hidden="true" class="header-anchor">#</a> Create a new Azure Function</h3><p>Azure Functions are the Azure Serverless platform. It allows you to write Node functions that run in the cloud without having to deploy Node or any runtime at all. You just write your code and let it run.</p><ol><li>Create a new resource in Azure and select &quot;Function App&quot;.</li></ol><p><img src="/assets/img/new-function-app.4a795617.png" alt></p><ol start="2"><li>Name it &quot;ParticleFunctionApp&quot; and select whichever Resource Group you have been using so far. Click the &quot;Create&quot; button at the bottom.</li></ol><p>When you create a new resource in Azure, you can find it under the bell icon in the right-hand corner. You will be notified when the resource is created. It's a good idea to click the &quot;Add to dashboard&quot; button at that time.</p><p><img src="/assets/img/pin-to-dashboard.48e9b74c.png" alt></p><ol start="3"><li>In your new Function App, click the + button next to &quot;Functions&quot; in the sidebar, then change the language to &quot;JavaScript&quot; and select &quot;Custom Function&quot;.</li></ol><p><img src="/assets/img/new-function-screen.56909637.png" alt></p><ol start="4"><li>Scroll down until you see the &quot;IoT Hub (Event Hub)&quot; card. Select &quot;JavaScript&quot; on that card.</li></ol><p><img src="/assets/img/custom-function-types.b1b6ea34.png" alt></p><ol start="5"><li>Name it &quot;particle_event_hub_function&quot; and select &quot;new&quot; under the &quot;Event Hub Connection&quot; option.</li></ol><p><img src="/assets/img/function-iot-hub-config.afc18ba0.png" alt></p><ol start="6"><li>Select your IoT Hub in the dropdown list and leave the Endpoint at &quot;Events (built-in endpoint)&quot;</li></ol><p><img src="/assets/img/new-event-hub-connection.3c49c99e.png" alt></p><ol start="7"><li>Set the Consumer Group to &quot;function&quot; and the Event Hub Name to the name of your IoT Hub. Click &quot;Create&quot;.</li></ol><p><img src="/assets/img/new-event-hub-connection.3c49c99e.png" alt></p><p>Your new Azure Function will be loaded up.</p><ol start="8"><li>Change the code for your function so that the message is stringified</li></ol><div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> IoTHubMessages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  context<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token string">`JavaScript eventhub trigger function called for message array: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>IoTHubMessages<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  IoTHubMessages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>message <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Processed message: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  context<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol start="9"><li>Hit the &quot;Run&quot; button to run your function. Every ten seconds you should see your temperature come through as the &quot;data&quot; property in the console.</li></ol><p><img src="/assets/img/run-function-app.93b36111.png" alt></p><p>This function will be fired every time we receve temperature data. We want to make a call back to our Particle Photon when we receive a temperature update. To do that, we need to make an HTTP call. The <code>http</code> package in Node is verbose and tedious, so we're going to install the <code>particle-api-js</code> npm package.</p><ol start="10"><li>Select the main Function App in the sidebar and then select the &quot;Platform features&quot; option.</li></ol><p><img src="/assets/img/function-app-settings.76a79d75.png" alt></p><ol start="11"><li>Select the &quot;Advanced Tools (Kudu)&quot; option.</li></ol><p><img src="/assets/img/found-kudu.c44bd557.png" alt></p><ol start="12"><li>Select the &quot;Debug Console&quot; and the &quot;CMD&quot; options.</li></ol><p><img src="/assets/img/kudu-cmd.93418333.png" alt></p><ol start="13"><li>In the prompt that comes up, switch to the <code>site/wwwroot</code> directory</li></ol><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">cd</span> site/wwwroot
</code></pre></div><p><img src="/assets/img/change-to-wwwroot.a4015283.png" alt></p><ol start="14"><li>We want to install the <code>request</code> package from npm that will make our HTTP request a lot easier. Type the following in the prompt...</li></ol><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> particle-api-js
</code></pre></div><p>This will install the <code>particle-api-js</code> npm package into your Azure Functions project. It can take a few minutes to finish. It will report an error about there being no <code>package.json</code> file, but this is ok. The package is still installed.</p><p><img src="/assets/img/npm-install.3ed6e752.png" alt></p><p>Close the tab for the Kudu tools to return to the original Functions project.</p><p>Now we're ready to make a request to change the color of the LED. To do that, you are going to need your Particle token.</p><ol start="15"><li>Open a browser tab and navigate to the Particle IDE at <a href="build.particle.com">build.particle.com</a></li></ol><p><img src="/assets/img/get-access-token.349761b0.png" alt></p><ol start="16"><li>Return to the original Functions project and include the <code>particle-api-js</code> package at the top of the project.</li></ol><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> Particle <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'particle-api-js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="17"><li>Now create a new instance of the Particle API inside of the <code>module.exports</code> line.</li></ol><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> Particle <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'particle-api-js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> IoTHubMessages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> particle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Particle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  context<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token string">`JavaScript eventhub trigger function called for message array: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>IoTHubMessages<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  IoTHubMessages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>message <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Processed message: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  context<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol start="18"><li>Now you need to send an event to the Photon to change the light color. It looks like this...</li></ol><div class="language-javascript extra-class"><pre class="language-javascript"><code>particle
  <span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'setLED'</span><span class="token punctuation">,</span>
    data<span class="token punctuation">:</span> <span class="token string">'ff0000'</span><span class="token punctuation">,</span>
    isPrivate<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    auth<span class="token punctuation">:</span> <span class="token string">'[YOUR ACCESS KEY HERE]'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>body<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Event published succesfully'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      context<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to publish event: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Add this code to your function inside of the loop that checks our IoTHub Messages.</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> Particle <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'particle-api-js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> IoTHubMessages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> particle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Particle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  context<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token string">`JavaScript eventhub trigger function called for message array: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>IoTHubMessages<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  IoTHubMessages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>message <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Processed message: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    particle
      <span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">'setLED'</span><span class="token punctuation">,</span>
        data<span class="token punctuation">:</span> <span class="token string">'ff0000'</span><span class="token punctuation">,</span>
        isPrivate<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        auth<span class="token punctuation">:</span> <span class="token string">'[YOUR ACCESS KEY HERE]'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>body<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            context<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Event published succesfully'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          context<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to publish event: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  context<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol start="19"><li>That should turn your LED red. Now evaluate the incoming message to see if your temp is less than 90. If so, turn it blue. If it's greater than 90, make it red. Here is the complete code.</li></ol><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> Particle <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'particle-api-js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> IoTHubMessages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  context<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token string">`JavaScript eventhub trigger function called for message array: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>IoTHubMessages<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> particle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Particle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  IoTHubMessages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>message <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// set the color to blue</span>
    <span class="token keyword">let</span> hex <span class="token operator">=</span> <span class="token string">'336699'</span><span class="token punctuation">;</span>

    <span class="token comment">// if the temp</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>data <span class="token operator">&gt;</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      hex <span class="token operator">=</span> <span class="token string">'ff0000'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    particle
      <span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">'setLED'</span><span class="token punctuation">,</span>
        data<span class="token punctuation">:</span> hex<span class="token punctuation">,</span>
        isPrivate<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        auth<span class="token punctuation">:</span> <span class="token string">'210c758918922015c2f98f3155743a9c2fb68567'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>body<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            context<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Event published succesfully'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          context<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed to publish event: '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  context<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/particle-iot/maker-kit-workshop/edit/master/docs/ch5.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/docs/ch4.html" class="prev">
          Chapter 4: Visualizing sensor data in the cloud
        </a></span><!----></p></div></div></div></div>
    <script src="/assets/js/0.a98946f6.js" defer></script><script src="/assets/js/app.f96e0021.js" defer></script>
  </body>
</html>
